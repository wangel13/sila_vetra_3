truncate declarations;
insert into declarations
(
    direction,
    month,
    year,
    country_code,
    tnved,
    measurement_units,
    amount_usd,
    net_weight,
    kol,
    region,
    region_s
) (
    select
        lower(napr) as direction,
        split_part(period, '/', 1)::smallint as month,
        split_part(period, '/', 2)::smallint as year,
        lower(nastranapr) as country_code,
        trim(tnved) as tnved,
        trim(edizm) as measurement_units,
        replace(stoim, ',', '.')::decimal as amount_usd,
        trim(netto) as net_weight,
        trim(kol) as kol,
        trim(region) as region,
        trim(region_s) as region_s
    from
        dataset
  );


truncate per_year_declarations;
insert into per_year_declarations
(
    direction,
    year,
    tnved,
    amount_usd
) (
    select
        direction,
        year,
        tnved,
        sum(amount_usd) as amount_usd
    from
        declarations
    group by direction, year, tnved
  );


truncate per_year_ratio_declarations;
insert into per_year_ratio_declarations
(
    year,
    tnved,
    import_amount_usd,
    export_amount_usd
) (
    select
        coalesce(l.year, r.year) as year,
        coalesce(l.tnved, r.tnved) as tnved,
        l.amount_usd as import_amount_usd,
        r.amount_usd as export_amount_usd
    from
        per_year_declarations as l
        left join per_year_declarations as r
        on l.direction != r.direction and l.tnved = r.tnved and l.year = r.year
    where
        l.direction = 'им'
  );

-- Объединяем данные за текущий и прошлый год в одну таблицу

truncate import_year_to_year_declarations;
insert into import_year_to_year_declarations
(
    tnved,
    year,
    amount_usd,
    before_year,
    before_amount_usd
)
SELECT
    l.tnved as tnved,
    l.year as year,
    l.amount_usd as amount_usd,
    r.year as before_year,
    r.amount_usd as before_amount_usd
from
    per_year_declarations as l
    left join per_year_declarations r
    on l.year > r.year and l.year - r.year = 1 and l.tnved = r.tnved and l.direction = r.direction
where
    l.direction = 'им'
order by
    year desc;

-- Перечень не дружественных стран
truncate countries_friendliness;
insert into countries_friendliness
(
    country_code,
    country_friendliness
)
values
    (
        'af',
        false
    ),
    (
        'at',
        false
    ),
    (
        'au',
        false
    ),
    (
        'al',
        false
    ),
    (
        'ai',
        false
    ),
    (
        'be',
        false
    ),
    (
        'bg',
        false
    ),
    (
        'vg',
        false
    ),
    (
        'gb',
        false
    ),
    (
        'hu',
        false
    ),
    (
        'de',
        false
    ),
    (
        'gi',
        false
    ),
    (
        'gr',
        false
    ),
    (
        'dk',
        false
    ),
    (
        'je',
        false
    ),
    (
        'ie',
        false
    ),
    (
        'is',
        false
    ),
    (
        'es',
        false
    ),
    (
        'it',
        false
    ),
    (
        'ca',
        false
    ),
    (
        'cy',
        false
    ),
    (
        'lv',
        false
    ),
    (
        'lt',
        false
    ),
    (
        'lu',
        false
    ),
    (
        'mt',
        false
    ),
    (
        'mc',
        false
    ),
    (
        'nl',
        false
    ),
    (
        'nz',
        false
    ),
    (
        'no',
        false
    ),
    (
        'pl',
        false
    ),
    (
        'pt',
        false
    ),
    (
        'ro',
        false
    ),
    (
        'sg',
        false
    ),
    (
        'sk',
        false
    ),
    (
        'si',
        false
    ),
    (
        'us',
        false
    ),
    (
        'tw',
        false
    ),
    (
        'fi',
        false
    ),
    (
        'fr',
        false
    ),
    (
        'hr',
        false
    ),
    (
        'me',
        false
    ),
    (
        'cz',
        false
    ),
    (
        'se',
        false
    ),
    (
        'ch',
        false
    ),
    (
        'ua',
        false
    ),
    (
        'ee',
        false
    ),
    (
        'kr',
        false
    ),
    (
        'jp',
        false
    ),
    (
        'ad',
        false
    ),
    (
        'li',
        false
    ),
    (
        'fm',
        false
    ),
    (
        'sm',
        false
    ),
    (
        'mk',
        false
    );

-- Перечень жизненно важных тн вэд
truncate tnved_vital;
insert into tnved_vital
(
    tnved
)
values
    (
        '70190'
    ),
    (
        '70310'
    ),
    (
        '703200000'
    ),
    (
        '704901001'
    ),
    (
        '706100001'
    ),
    (
        '70960100'
    ),
    (
        '710805100'
    ),
    (
        '1002'
    ),
    (
        '1006102500'
    ),
    (
        '1006102700'
    ),
    (
        '1006109600'
    ),
    (
        '1006109800'
    ),
    (
        '1006201500'
    ),
    (
        '1006201700'
    ),
    (
        '1006209600'
    ),
    (
        '1006209800'
    ),
    (
        '1006302500'
    ),
    (
        '1006302700'
    ),
    (
        '1006304600'
    ),
    (
        '1006304800'
    ),
    (
        '1006306500'
    ),
    (
        '1006306709'
    ),
    (
        '1006309600'
    ),
    (
        '1006309809'
    ),
    (
        '100810000'
    ),
    (
        '1103199009'
    ),
    (
        '1104293000'
    ),
    (
        '1904908000'
    ),
    (
        '1901100000'
    ),
    (
        '1901909900'
    ),
    (
        '2009120001'
    ),
    (
        '2009419201'
    ),
    (
        '2009501001'
    ),
    (
        '2009611002'
    ),
    (
        '2009712001'
    ),
    (
        '2009903901'
    ),
    (
        '2009904102'
    ),
    (
        '2009905102'
    ),
    (
        '3004100004'
    ),
    (
        '3004100005'
    ),
    (
        '3004100007'
    ),
    (
        '3004100008'
    ),
    (
        '3004200001'
    ),
    (
        '3004200002'
    ),
    (
        '3004200009'
    ),
    (
        '3004390001'
    ),
    (
        '3004390009'
    ),
    (
        '3004500001'
    ),
    (
        '3004500002'
    ),
    (
        '3004600000'
    ),
    (
        '3004900002'
    ),
    (
        '3004900009'
    ),
    (
        '3926909709'
    ),
    (
        '8705908005'
    ),
    (
        '8705908009'
    ),
    (
        '9018902000'
    ),
    (
        '9025192000'
    );

truncate countries;
insert into countries
(
    country_name,
    country_code
)
values
    (
        'австралия',
        'au'
    ),
    (
        'австрия',
        'at'
    ),
    (
        'азербайджан',
        'az'
    ),
    (
        'албания',
        'al'
    ),
    (
        'алжир',
        'dz'
    ),
    (
        'ангилья',
        'ai'
    ),
    (
        'ангола',
        'ao'
    ),
    (
        'андорра',
        'ad'
    ),
    (
        'антарктика',
        'aq'
    ),
    (
        'антигуа.барб',
        'ag'
    ),
    (
        'антильские о-ва',
        'an'
    ),
    (
        'аомынь (макао),',
        'mo'
    ),
    (
        'аргентина',
        'ar'
    ),
    (
        'армения',
        'am'
    ),
    (
        'аруба',
        'aw'
    ),
    (
        'афганистан',
        'af'
    ),
    (
        'багамские о-ва',
        'bs'
    ),
    (
        'бангладеш',
        'bd'
    ),
    (
        'барбадос',
        'bb'
    ),
    (
        'бахрейн',
        'bh'
    ),
    (
        'белиз',
        'bz'
    ),
    (
        'беларусь',
        'by'
    ),
    (
        'бельгия',
        'be'
    ),
    (
        'бенин',
        'bj'
    ),
    (
        'бермудские о-ва',
        'bm'
    ),
    (
        'болгария',
        'bg'
    ),
    (
        'боливия',
        'bo'
    ),
    (
        'ботсвана',
        'bw'
    ),
    (
        'бразилия',
        'br'
    ),
    (
        'брит. тер. в инд. ок',
        'io'
    ),
    (
        'бруней',
        'bn'
    ),
    (
        'буве',
        'bv'
    ),
    (
        'буркина-фасо',
        'bf'
    ),
    (
        'бурунди',
        'bi'
    ),
    (
        'бутан',
        'bt'
    ),
    (
        'вануату',
        'vu'
    ),
    (
        'ватикан',
        'va'
    ),
    (
        'великобритания',
        'gb'
    ),
    (
        'венгрия',
        'hu'
    ),
    (
        'венесуэла',
        've'
    ),
    (
        'виргин. о-ва (сша),',
        'vi'
    ),
    (
        'виргин. о-ва (брит.),',
        'vg'
    ),
    (
        'вост. самоа. (сша),',
        'as'
    ),
    (
        'восточный тимор',
        'tp'
    ),
    (
        'вьетнам',
        'vn'
    ),
    (
        'габон',
        'ga'
    ),
    (
        'гаити',
        'ht'
    ),
    (
        'гайана',
        'gy'
    ),
    (
        'гамбия',
        'gm'
    ),
    (
        'гана',
        'gh'
    ),
    (
        'гваделупа',
        'gp'
    ),
    (
        'гватемала',
        'gt'
    ),
    (
        'гвиана',
        'gf'
    ),
    (
        'гвинея',
        'gn'
    ),
    (
        'гвинея-бисау',
        'gw'
    ),
    (
        'германия',
        'de'
    ),
    (
        'гибралтар',
        'gi'
    ),
    (
        'гондурас',
        'hn'
    ),
    (
        'гренада',
        'gd'
    ),
    (
        'гренландия',
        'gl'
    ),
    (
        'греция',
        'gr'
    ),
    (
        'грузия',
        'ge'
    ),
    (
        'гуам',
        'gu'
    ),
    (
        'дания',
        'dk'
    ),
    (
        'джибути',
        'dj'
    ),
    (
        'джонстон атолл',
        'jt'
    ),
    (
        'доминика',
        'dm'
    ),
    (
        'доминиканск. респ.',
        'do'
    ),
    (
        'египет',
        'eg'
    ),
    (
        'заир',
        'zr'
    ),
    (
        'замбия',
        'zm'
    ),
    (
        'западная сахара',
        'eh'
    ),
    (
        'западное самоа',
        'ws'
    ),
    (
        'зимбабве',
        'zw'
    ),
    (
        'израиль',
        'il'
    ),
    (
        'индия',
        'in'
    ),
    (
        'индонезия',
        'id'
    ),
    (
        'иордания',
        'jo'
    ),
    (
        'ирак',
        'iq'
    ),
    (
        'иран',
        'ir'
    ),
    (
        'ирландия',
        'ie'
    ),
    (
        'исландия',
        'is'
    ),
    (
        'испания',
        'es'
    ),
    (
        'италия',
        'it'
    ),
    (
        'йемен',
        'ye'
    ),
    (
        'кабо-верде',
        'cv'
    ),
    (
        'казахстан',
        'kz'
    ),
    (
        'кайман',
        'ky'
    ),
    (
        'камбоджа',
        'kh'
    ),
    (
        'камерун',
        'cm'
    ),
    (
        'канада',
        'ca'
    ),
    (
        'катар',
        'qa'
    ),
    (
        'кения',
        'ke'
    ),
    (
        'кипр',
        'cy'
    ),
    (
        'кирибати',
        'ki'
    ),
    (
        'китай',
        'cn'
    ),
    (
        'кокосовые о-ва',
        'cc'
    ),
    (
        'колумбия',
        'co'
    ),
    (
        'коморские о-ва',
        'km'
    ),
    (
        'конго',
        'cg'
    ),
    (
        'корея (кндр),',
        'kp'
    ),
    (
        'корея респ.',
        'kr'
    ),
    (
        'коста-рика',
        'cr'
    ),
    (
        'кот-д ивуар',
        'ci'
    ),
    (
        'куба',
        'cu'
    ),
    (
        'кувейт',
        'kw'
    ),
    (
        'кыргызстан',
        'kg'
    ),
    (
        'лаос',
        'la'
    ),
    (
        'латвия',
        'lv'
    ),
    (
        'литва',
        'lt'
    ),
    (
        'лесото',
        'ls'
    ),
    (
        'либерия',
        'lr'
    ),
    (
        'ливан',
        'lb'
    ),
    (
        'ливия',
        'ly'
    ),
    (
        'лихтенштейн',
        'li'
    ),
    (
        'люксембург',
        'lu'
    ),
    (
        'маврикий',
        'mu'
    ),
    (
        'мавритания',
        'mr'
    ),
    (
        'мадагаскар',
        'mg'
    ),
    (
        'малави',
        'mw'
    ),
    (
        'малайзия',
        'my'
    ),
    (
        'мали',
        'ml'
    ),
    (
        'мал. тихоок. о-ва',
        'um'
    ),
    (
        'мальдивы',
        'mv'
    ),
    (
        'мальта',
        'mt'
    ),
    (
        'марианские о-ва',
        'mp'
    ),
    (
        'марокко',
        'ma'
    ),
    (
        'мартиника',
        'mq'
    ),
    (
        'маршалловы о-ва',
        'mh'
    ),
    (
        'мексика',
        'mx'
    ),
    (
        'микронезия',
        'fm'
    ),
    (
        'мозамбик',
        'mz'
    ),
    (
        'молдова',
        'md'
    ),
    (
        'монако',
        'mc'
    ),
    (
        'монголия',
        'mn'
    ),
    (
        'монтсеррат',
        'ms'
    ),
    (
        'мьянма',
        'mm'
    ),
    (
        'намибия',
        'na'
    ),
    (
        'науру',
        'nr'
    ),
    (
        'непал',
        'np'
    ),
    (
        'нигер',
        'ne'
    ),
    (
        'нигерия',
        'ng'
    ),
    (
        'нидерланды',
        'nl'
    ),
    (
        'никарагуа',
        'ni'
    ),
    (
        'ниуэ',
        'nu'
    ),
    (
        'новая зеландия',
        'nz'
    ),
    (
        'нов. каледония',
        'nc'
    ),
    (
        'норвегия',
        'no'
    ),
    (
        'норфолк',
        'nf'
    ),
    (
        'объед. араб. эмират',
        'ae'
    ),
    (
        'оман',
        'om'
    ),
    (
        'о-ва кука',
        'ck'
    ),
    (
        'о-ва мидуэй',
        'mi'
    ),
    (
        'о-в мэн',
        'im'
    ),
    (
        'о-в рождества',
        'cx'
    ),
    (
        'о-в святой елены',
        'sh'
    ),
    (
        'о-в уэйк',
        'wk'
    ),
    (
        'пакистан',
        'pk'
    ),
    (
        'палау',
        'pw'
    ),
    (
        'панама',
        'pa'
    ),
    (
        'папуа-новая гвинея',
        'pg'
    ),
    (
        'парагвай',
        'py'
    ),
    (
        'перу',
        'pe'
    ),
    (
        'питкэрн',
        'pn'
    ),
    (
        'польша',
        'pl'
    ),
    (
        'португалия',
        'pt'
    ),
    (
        'пуэрто-рико',
        'pr'
    ),
    (
        'разделенная зона',
        'nt'
    ),
    (
        'реюньон',
        're'
    ),
    (
        'россия',
        'ru'
    ),
    (
        'руанда',
        'rw'
    ),
    (
        'румыния',
        'ro'
    ),
    (
        'сальвадор',
        'sv'
    ),
    (
        'сан-марино',
        'sm'
    ),
    (
        'сан-томе и принс.',
        'st'
    ),
    (
        'саудовская аравия',
        'sa'
    ),
    (
        'свазиленд',
        'sz'
    ),
    (
        'сейшельские о-ва',
        'sc'
    ),
    (
        'с.-пьер и микелон',
        'pm'
    ),
    (
        'сенегал',
        'sn'
    ),
    (
        'с. винсент. гренад.',
        'vc'
    ),
    (
        'сент-китс и невис',
        'kn'
    ),
    (
        'сент-люсия',
        'lc'
    ),
    (
        'сингапур',
        'sg'
    ),
    (
        'сирия',
        'sy'
    ),
    (
        'словакия',
        'sk'
    ),
    (
        'соломоновы о-ва',
        'sb'
    ),
    (
        'сомали',
        'so'
    ),
    (
        'судан',
        'sd'
    ),
    (
        'суринам',
        'sr'
    ),
    (
        'сьерра-леоне',
        'sl'
    ),
    (
        'сша',
        'us'
    ),
    (
        'сянган (гонконг), ',
        'hk'
    ),
    (
        'таджикистан',
        'tj'
    ),
    (
        'таиланд',
        'th'
    ),
    (
        'тайвань',
        'tw'
    ),
    (
        'танзания',
        'tz'
    ),
    (
        'теркс и кайкос',
        'tc'
    ),
    (
        'того',
        'tg'
    ),
    (
        'токелау (юнион), ',
        'tk'
    ),
    (
        'тонга',
        'to'
    ),
    (
        'тринидад и тобаго',
        'tt'
    ),
    (
        'тувалу',
        'tv'
    ),
    (
        'тунис',
        'tn'
    ),
    (
        'туркменистан',
        'tm'
    ),
    (
        'турция',
        'tr'
    ),
    (
        'уганда',
        'ug'
    ),
    (
        'узбекистан',
        'uz'
    ),
    (
        'украина',
        'ua'
    ),
    (
        'уоллис и футуна',
        'wf'
    ),
    (
        'уругвай',
        'uy'
    ),
    (
        'фарерские о-ва',
        'fo'
    ),
    (
        'фиджи',
        'fj'
    ),
    (
        'филиппины',
        'ph'
    ),
    (
        'финляндия',
        'fi'
    ),
    (
        'фолклендские о-ва',
        'fk'
    ),
    (
        'франция',
        'fr'
    ),
    (
        'фр. полинезия',
        'pf'
    ),
    (
        'фр. южные территор.',
        'tf'
    ),
    (
        'херд и макдональд',
        'hm'
    ),
    (
        'центр. афр. республ',
        'cf'
    ),
    (
        'чад',
        'td'
    ),
    (
        'чешская республика',
        'cz'
    ),
    (
        'чили',
        'cl'
    ),
    (
        'швейцария',
        'ch'
    ),
    (
        'швеция',
        'se'
    ),
    (
        'шпицберген и ян-майе',
        'sj'
    ),
    (
        'шри-ланка',
        'lk'
    ),
    (
        'эквадор',
        'ec'
    ),
    (
        'экватор. гвинея',
        'gq'
    ),
    (
        'эстония',
        'ee'
    ),
    (
        'эфиопия',
        'et'
    ),
    (
        'югославия',
        'yu'
    ),
    (
        'южно-афр. респуб.',
        'za'
    ),
    (
        'ямайка',
        'jm'
    ),
    (
        'япония',
        'jp'
    );

--

truncate adjustment_scores;
insert into adjustment_scores
(
    tnved,
    score
)
SELECT
    l.tnved,
    -100 as score
FROM
    tnved l
WHERE
    title ilike '%антиквар%'
on conflict (tnved) do update set
    score = excluded.score;

insert into adjustment_scores
(
    tnved,
    score
)
SELECT
    l.tnved,
    10 as score
FROM
    tnved l
WHERE
    title ilike '%медикаменты%'
on conflict (tnved) do update set
    score = excluded.score;
